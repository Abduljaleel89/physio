(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[114],{43793:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/requests",function(){return s(3949)}])},3949:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return RequestsAdminPage}});var a=s(85893),d=s(67294),r=s(36008),n=s(39367),l=s(46435);function RequestsAdminPage(){let{user:e,loading:t}=(0,n.a)(),[s,i]=(0,d.useState)([]),[o,c]=(0,d.useState)([]),[u,x]=(0,d.useState)(""),[p,h]=(0,d.useState)({});(0,d.useEffect)(()=>{!t&&e&&(load(),loadDoctors())},[t,e]);let loadDoctors=async()=>{try{let e=await l.Nq.getDoctors(),t=e.data||e,s=Array.isArray(t)?t:(null==t?void 0:t.doctors)||[];c(s||[])}catch(e){}},load=async()=>{try{x("");let e=await l.WI.list(),t=e.data||e,s=Array.isArray(t)?t:(null==t?void 0:t.requests)||(null==t?void 0:t.data)||[];i(s||[])}catch(e){x(e.message||"Failed to load")}},onAssign=async e=>{let t=p[e]||{};if(!t.doctorId){x("Select a doctor");return}let s=t.date&&t.time?new Date("".concat(t.date,"T").concat(t.time,":00")).toISOString():void 0;try{let a=await l.WI.assign(e,{doctorId:t.doctorId,date:s,duration:t.duration,notes:t.notes});if(!a.success)throw Error(a.error||"Failed to assign");await load()}catch(e){x(e.message||"Failed to assign")}},onRespond=async(e,t)=>{try{let s=await l.WI.respond(e,{status:t});if(!s.success)throw Error(s.error||"Failed");await load()}catch(e){x(e.message||"Failed")}},m=(null==e?void 0:e.role)==="ADMIN"||(null==e?void 0:e.role)==="RECEPTIONIST",g=(null==e?void 0:e.role)==="PHYSIOTHERAPIST";return(0,a.jsx)(r.Z,{children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Visit Requests"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Manage incoming patient requests."}),u&&(0,a.jsx)("div",{className:"mb-4 p-3 border border-red-200 bg-red-50 text-sm text-red-700",children:u}),(0,a.jsx)("div",{className:"bg-white border rounded-lg shadow overflow-hidden",children:(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-50 text-left",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2",children:"Patient"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"Requested"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"Reason"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"Status"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"Action"})]})}),(0,a.jsx)("tbody",{children:s.map(e=>{var t,s,d,r,n,l,i;return(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsxs)("td",{className:"px-4 py-3",children:[null===(t=e.patient)||void 0===t?void 0:t.firstName," ",null===(s=e.patient)||void 0===s?void 0:s.lastName]}),(0,a.jsx)("td",{className:"px-4 py-3",children:new Date(e.requestedAt||e.requestedDate||e.createdAt).toLocaleString()}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.reason||"-"}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded-full border ".concat("APPROVED"===e.status?"bg-green-50 text-green-700 border-green-200":"REJECTED"===e.status?"bg-red-50 text-red-700 border-red-200":"bg-yellow-50 text-yellow-800 border-yellow-200"),children:e.status})}),(0,a.jsxs)("td",{className:"px-4 py-3",children:[g&&(0,a.jsxs)("div",{className:"space-x-2",children:[(0,a.jsx)("button",{onClick:()=>onRespond(e.id,"APPROVED"),className:"px-3 py-1 text-sm bg-green-600 text-white rounded",children:"Approve"}),(0,a.jsx)("button",{onClick:()=>onRespond(e.id,"REJECTED"),className:"px-3 py-1 text-sm bg-red-600 text-white rounded",children:"Reject"})]}),m&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("select",{className:"border rounded px-2 py-1",value:(null===(d=p[e.id])||void 0===d?void 0:d.doctorId)||"",onChange:t=>h(s=>({...s,[e.id]:{...s[e.id],doctorId:parseInt(t.target.value)}})),children:[(0,a.jsx)("option",{value:"",children:"Doctorâ€¦"}),o.map(e=>(0,a.jsxs)("option",{value:e.id,children:["Dr. ",e.firstName," ",e.lastName]},e.id))]}),(0,a.jsx)("input",{type:"date",className:"border rounded px-2 py-1",value:(null===(r=p[e.id])||void 0===r?void 0:r.date)||"",onChange:t=>h(s=>({...s,[e.id]:{...s[e.id],date:t.target.value}}))}),(0,a.jsx)("input",{type:"time",className:"border rounded px-2 py-1",value:(null===(n=p[e.id])||void 0===n?void 0:n.time)||"",onChange:t=>h(s=>({...s,[e.id]:{...s[e.id],time:t.target.value}}))}),(0,a.jsx)("input",{type:"number",className:"border rounded px-2 py-1",placeholder:"Duration (min)",value:(null===(l=p[e.id])||void 0===l?void 0:l.duration)||60,onChange:t=>h(s=>({...s,[e.id]:{...s[e.id],duration:parseInt(t.target.value||"60")}}))}),(0,a.jsx)("input",{type:"text",className:"border rounded px-2 py-1 col-span-2",placeholder:"Notes (optional)",value:(null===(i=p[e.id])||void 0===i?void 0:i.notes)||"",onChange:t=>h(s=>({...s,[e.id]:{...s[e.id],notes:t.target.value}}))})]}),(0,a.jsx)("button",{onClick:()=>onAssign(e.id),className:"px-3 py-1 text-sm bg-blue-600 text-white rounded",children:"Assign & Schedule"})]})]})]},e.id)})})]})})]})})}}},function(e){e.O(0,[424,8,774,888,179],function(){return e(e.s=43793)}),_N_E=e.O()}]);