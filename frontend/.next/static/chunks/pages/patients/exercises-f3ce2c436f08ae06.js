(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[783],{37641:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/patients/exercises",function(){return t(80569)}])},80569:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return MyExercisesPage}});var a=t(85893),l=t(67294),i=t(36008),r=t(39367),n=t(46435),d=t(83454);function MyExercisesPage(){var e;let{user:s,loading:t}=(0,r.a)(),[c,o]=(0,l.useState)(!0),[x,m]=(0,l.useState)(""),[u,h]=(0,l.useState)(null),[p,v]=(0,l.useState)([]),[g,y]=(0,l.useState)(null),[b,N]=(0,l.useState)(0),[j,f]=(0,l.useState)(""),[w,C]=(0,l.useState)(null),[E,S]=(0,l.useState)(!1),[P,_]=(0,l.useState)([]);(0,l.useEffect)(()=>{let init=async()=>{if(!t&&!s){window.location.href="/login";return}if(s&&"PATIENT"===s.role)try{o(!0);let e=await n.yN.getMyPatientId();e&&h(e);let s=await n.NU.list(),t=s.data||s,a=Array.isArray(t)?t:(null==t?void 0:t.therapyPlans)||(null==t?void 0:t.data)||[],l=a.filter(s=>{var t;return s.patientId===e||(null===(t=s.patient)||void 0===t?void 0:t.id)===e});v(l),m("")}catch(e){m(e.message||"Failed to load data")}finally{o(!1)}};init()},[s,t]);let openComplete=e=>{y(e),N(0),f(""),C(null)},submitCompletion=async e=>{if(e.preventDefault(),u&&g)try{S(!0);let e={therapyPlanExerciseId:g.id||g.therapyPlanExerciseId,pain:String(b),notes:j};w&&(e.file=w);let s=await n.zP.create(u,e);if(!s.success)throw Error(s.error||"Failed");y(null),f(""),N(0),C(null);try{let e=await n.yN.getCompletions(void 0),s=e.data||e,t=Array.isArray(s)?s:(null==s?void 0:s.completionEvents)||(null==s?void 0:s.data)||[];_(t.slice(0,10))}catch(e){}}catch(e){var s,t;m((null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.error)||e.message||"Failed to save")}finally{S(!1)}},undoCompletion=async e=>{try{let s=d.env.NEXT_PUBLIC_API_BASE||"http://localhost:4000",t=s.endsWith("/api")?s:"".concat(s,"/api"),a=await fetch("".concat(t,"/completion-events/").concat(e.id,"/undo"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")||"")},body:JSON.stringify({reason:"Self undo"})}),l=await a.json();if(!l.success)throw Error(l.error||"Failed");_(s=>s.filter(s=>s.id!==e.id))}catch(e){m(e.message||"Failed to undo")}};return t||c?(0,a.jsx)(i.Z,{children:(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"text-gray-500",children:"Loading…"})})}):s&&"PATIENT"===s.role&&u?(0,a.jsx)(i.Z,{children:(0,a.jsxs)("div",{className:"px-4 sm:px-0",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"My Exercises"}),(0,a.jsx)("p",{className:"text-gray-600",children:"View your therapy plans and log completions"})]}),x&&(0,a.jsx)("div",{className:"mb-6 rounded-lg bg-red-50 border border-red-200 p-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("svg",{className:"h-5 w-5 text-red-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),(0,a.jsx)("div",{className:"ml-3 text-sm text-red-700",children:x})]})}),0===p.length?(0,a.jsx)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 p-6 text-gray-600",children:"No therapy plans assigned yet."}):(0,a.jsx)("div",{className:"space-y-6",children:p.map(e=>(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[(0,a.jsxs)("div",{className:"p-4 border-b",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:[e.name||"Therapy Plan"," ",(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["(v",e.version||1,")"]})]}),e.doctor&&(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Doctor: Dr. ",e.doctor.firstName," ",e.doctor.lastName]})]}),(0,a.jsx)("div",{className:"p-4",children:e.exercises&&0!==e.exercises.length?(0,a.jsx)("ul",{className:"divide-y divide-gray-100",children:e.exercises.map(e=>{var s,t;return(0,a.jsxs)("li",{className:"py-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:(null===(s=e.exercise)||void 0===s?void 0:s.name)||e.name||"Exercise"}),(null===(t=e.exercise)||void 0===t?void 0:t.description)&&(0,a.jsx)("div",{className:"text-sm text-gray-600",children:e.exercise.description})]}),(0,a.jsx)("button",{onClick:()=>openComplete(e),className:"px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm",children:"Mark Complete"})]},e.id)})}):(0,a.jsx)("p",{className:"text-gray-500",children:"No exercises in this plan."})})]},e.id))}),g&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:[(0,a.jsxs)("div",{className:"p-4 border-b",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Log Completion"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:(null===(e=g.exercise)||void 0===e?void 0:e.name)||"Exercise"})]}),(0,a.jsxs)("form",{onSubmit:submitCompletion,className:"p-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pain level (0-10)"}),(0,a.jsx)("input",{type:"number",min:0,max:10,value:b,onChange:e=>N(parseInt(e.target.value||"0")),className:"w-full px-3 py-2 border rounded-lg"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),(0,a.jsx)("textarea",{rows:3,value:j,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border rounded-lg"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Attach photo/video (optional)"}),(0,a.jsx)("input",{type:"file",accept:"image/*,video/*",onChange:e=>{var s;return C((null===(s=e.target.files)||void 0===s?void 0:s[0])||null)},className:"w-full"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>y(null),className:"px-4 py-2 border rounded-lg",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:E,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:E?"Saving…":"Save"})]})]})]})}),P.length>0&&(0,a.jsxs)("div",{className:"mt-8 bg-white rounded-xl shadow-lg border border-gray-200",children:[(0,a.jsx)("div",{className:"p-4 border-b",children:(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Completions"})}),(0,a.jsx)("ul",{className:"divide-y divide-gray-100",children:P.map(e=>{var s;return(0,a.jsxs)("li",{className:"p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(null===(s=e.exercise)||void 0===s?void 0:s.name)||e.exerciseName||"Exercise"}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.completedAt||e.createdAt).toLocaleString()})]}),!e.undone&&e.canUndo&&(0,a.jsx)("button",{onClick:()=>undoCompletion(e),className:"px-3 py-1 text-sm border rounded",children:"Undo"})]},e.id)})})]})]})}):(0,a.jsx)(i.Z,{children:(0,a.jsx)("div",{className:"text-gray-600",children:"This page is for patients."})})}}},function(e){e.O(0,[424,8,774,888,179],function(){return e(e.s=37641)}),_N_E=e.O()}]);