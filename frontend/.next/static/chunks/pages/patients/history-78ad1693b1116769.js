(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[823],{52792:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/patients/history",function(){return a(78109)}])},78109:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return PatientHistoryPage}});var s=a(85893),l=a(67294),n=a(36008),d=a(39367),r=a(46435),i=a(29557),o=a(69330),c=a(14195),u=a(3023),x=a(75358),h=a(63440),m=a(10004),y=a(57783),p=a(45808);function PatientHistoryPage(){let{user:e,loading:t}=(0,d.a)(),[a,b]=(0,l.useState)(!0),[j,g]=(0,l.useState)(""),[f,w]=(0,l.useState)((0,p.ZP)((0,y.Z)(new Date,14),"yyyy-MM-dd")),[N,v]=(0,l.useState)((0,p.ZP)(new Date,"yyyy-MM-dd")),[_,k]=(0,l.useState)([]),[P,Z]=(0,l.useState)(null);(0,l.useEffect)(()=>{if(!t&&!e){window.location.href="/login";return}e&&load()},[e,t]);let load=async()=>{try{b(!0);let e=await r.Yu.adherence(f+"T00:00:00.000Z",N+"T23:59:59.999Z"),t=e.data||e;k((null==t?void 0:t.daily)||[]),Z((null==t?void 0:t.summary)||null),g("")}catch(e){g(e.message||"Failed to load history")}finally{b(!1)}},apply=async e=>{e.preventDefault(),await load()};return t||a?(0,s.jsx)(n.Z,{children:(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)("div",{className:"text-gray-500",children:"Loadingâ€¦"})})}):e?(0,s.jsx)(n.Z,{children:(0,s.jsxs)("div",{className:"px-4 sm:px-0",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"My Completions History"}),P&&(0,s.jsxs)("p",{className:"text-gray-600",children:["Total completions: ",P.totalCompletions]})]}),j&&(0,s.jsx)("div",{className:"mb-6 rounded-lg bg-red-50 border border-red-200 p-4",children:(0,s.jsx)("div",{className:"text-sm text-red-700",children:j})}),(0,s.jsxs)("form",{onSubmit:apply,className:"mb-4 bg-white rounded-xl shadow-lg border border-gray-200 p-4 flex items-end space-x-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start"}),(0,s.jsx)("input",{type:"date",value:f,onChange:e=>w(e.target.value),className:"px-3 py-2 border rounded-lg"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End"}),(0,s.jsx)("input",{type:"date",value:N,onChange:e=>v(e.target.value),className:"px-3 py-2 border rounded-lg"})]}),(0,s.jsx)("div",{children:(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:"Apply"})})]}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 p-4",children:(0,s.jsx)("div",{className:"h-72",children:(0,s.jsx)(i.h,{width:"100%",height:"100%",children:(0,s.jsxs)(o.w,{data:_.map(e=>({...e,label:(0,p.ZP)(new Date(e.date),"MMM dd")})),children:[(0,s.jsx)(c.q,{strokeDasharray:"3 3"}),(0,s.jsx)(u.K,{dataKey:"label"}),(0,s.jsx)(x.B,{allowDecimals:!1}),(0,s.jsx)(h.u,{}),(0,s.jsx)(m.x,{type:"monotone",dataKey:"count",stroke:"#2563eb",strokeWidth:2})]})})})})]})}):null}},57783:function(e,t,a){"use strict";var s=a(21860);function subDays(e,t,a){return(0,s.E)(e,-t,a)}t.Z=subDays}},function(e){e.O(0,[424,192,307,8,774,888,179],function(){return e(e.s=52792)}),_N_E=e.O()}]);