(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[883],{11051:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/appointments",function(){return a(23633)}])},23633:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Appointments}});var l=a(85893),s=a(67294),r=a(11163),n=a(39367),i=a(36008),o=a(46435),d=a(5152),c=a.n(d),u=a(96827),m=a(45808),p=a(86300),x=a(53170),v=a(81429),b=a(54489);let g=c()(()=>Promise.resolve(u.f),{ssr:!1});function AppointmentCalendar(e){let t=(0,s.useMemo)(()=>({"en-US":b._}),[]),a=(0,s.useMemo)(()=>(0,u.lD)({format:m.ZP,parse:p.ZP,startOfWeek:()=>(0,x.Z)(new Date,{weekStartsOn:1}),getDay:v.Z,locales:t}),[t]);return(0,l.jsx)(g,{localizer:a,events:e.events,defaultView:e.defaultView,onView:e.onView,selectable:e.selectable,onSelectSlot:e.onSelectSlot,popup:!0,eventPropGetter:e=>{var t;let a=((null===(t=e.resource)||void 0===t?void 0:t.status)||"").toUpperCase(),l={};switch(a){case"SCHEDULED":l.backgroundColor="#3b82f6",l.borderColor="#2563eb";break;case"COMPLETED":l.backgroundColor="#10b981",l.borderColor="#059669";break;case"CANCELLED":case"CANCELED":l.backgroundColor="#ef4444",l.borderColor="#dc2626",l.opacity=.8;break;case"RESCHEDULED":l.backgroundColor="#f59e0b",l.borderColor="#d97706";break;default:l.backgroundColor="#6b7280",l.borderColor="#4b5563"}return l.color="white",{className:"",style:l}},style:e.style||{height:600}})}var h=a(86501);function Appointments(){let{user:e,loading:t}=(0,n.a)(),a=(0,r.useRouter)(),[d,c]=(0,s.useState)([]),[u,m]=(0,s.useState)(!0),[p,x]=(0,s.useState)(""),[v,b]=(0,s.useState)("week"),[g,y]=(0,s.useState)(null),[f,j]=(0,s.useState)(!1),[N,w]=(0,s.useState)(60),[S,C]=(0,s.useState)([]),[A,D]=(0,s.useState)([]),[E,k]=(0,s.useState)(null),[T,I]=(0,s.useState)(null),[P,q]=(0,s.useState)(""),[M,L]=(0,s.useState)(""),[O,_]=(0,s.useState)(""),[F,R]=(0,s.useState)(null),[Z,z]=(0,s.useState)(""),[V,U]=(0,s.useState)(""),[H,W]=(0,s.useState)(60),[X,B]=(0,s.useState)("");(0,s.useEffect)(()=>{if(!t&&!e){a.push("/login");return}e&&(loadAppointments(),loadMasterData())},[e,t,a]);let loadMasterData=async()=>{try{var t,a,l;if(!e)return;if("PATIENT"===e.role){let e=await o.Nq.getDoctors(),a=e.data&&Array.isArray(e.data)?e.data:(null===(t=e.data)||void 0===t?void 0:t.doctors)||[];D(a||[]);try{let e=await o.yN.getMyPatientId();e&&k(e)}catch(e){}}else{let e=await o.Nq.getPatients(),t=await o.Nq.getDoctors(),s=e.data&&Array.isArray(e.data)?e.data:(null===(a=e.data)||void 0===a?void 0:a.patients)||[],r=t.data&&Array.isArray(t.data)?t.data:(null===(l=t.data)||void 0===l?void 0:l.doctors)||[];C(s||[]),D(r||[])}}catch(e){}},loadAppointments=async()=>{try{m(!0);let e=await o.qC.list();if(e.success){let t=e.data,a=Array.isArray(t)?t:(null==t?void 0:t.appointments)||(null==t?void 0:t.data)||[];c(a)}}catch(e){x(e.message||"Failed to load appointments")}finally{m(!1)}},G=(0,s.useMemo)(()=>d.map(e=>{let t=new Date(e.date),a=new Date(t.getTime()+6e4*e.duration);return{start:t,end:a,title:"".concat(e.patient?e.patient.firstName+" "+e.patient.lastName:"Patient"," with ").concat(e.doctor?"Dr. "+e.doctor.firstName:"Doctor"," (").concat(e.status,")"),resource:e}}),[d]),onCreate=async t=>{t.preventDefault();try{let t;if(j(!0),t=M&&O?new Date("".concat(M,"T").concat(O,":00")).toISOString():g?g.start.toISOString():new Date().toISOString(),(null==e?void 0:e.role)==="PATIENT"){let e=await o.WI.create({requestedDate:t,reason:P||void 0,doctorId:T||void 0});if(!e.success)throw Error(e.error||"Failed to request visit");h.ZP.success("Visit request submitted"),y(null),q("");return}let a=await o.qC.create({patientId:E||void 0,doctorId:T||void 0,date:t,duration:N,status:"SCHEDULED",notes:P||void 0});if(!a.success)throw Error(a.error||"Failed");h.ZP.success("Appointment created"),y(null),q(""),await loadAppointments()}catch(e){var a,l;x((null===(l=e.response)||void 0===l?void 0:null===(a=l.data)||void 0===a?void 0:a.error)||e.message||"Failed to create appointment")}finally{j(!1)}},onSaveEdit=async e=>{if(e.preventDefault(),F)try{j(!0);let e=new Date("".concat(Z,"T").concat(V,":00")).toISOString(),t=await o.qC.update(F.id,{date:e,duration:H,notes:X});if(!t.success)throw Error(t.error||"Failed");R(null),await loadAppointments()}catch(l){var t,a;let e=(null==l?void 0:null===(a=l.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.error)||l.message||"Failed to update";x(e)}finally{j(!1)}},onCancelAppt=async()=>{if(F)try{j(!0);let e=await o.qC.cancel(F.id,X||"");if(!e.success)throw Error(e.error||"Failed");R(null),await loadAppointments()}catch(a){var e,t;x((null==a?void 0:null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.error)||a.message||"Failed to cancel")}finally{j(!1)}},onEventDrop=async t=>{let{event:a,start:l,end:s}=t;if(e&&"PATIENT"!==e.role)try{let e=Math.max(15,Math.round((s.getTime()-l.getTime())/6e4)),t=l.toISOString();await o.qC.update(a.resource.id,{date:t,duration:e}),h.ZP.success("Appointment rescheduled"),await loadAppointments()}catch(e){var r,n;h.ZP.error((null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(r=n.data)||void 0===r?void 0:r.error)||"Failed to reschedule")}},onEventResize=async t=>{let{event:a,start:l,end:s}=t;if(e&&"PATIENT"!==e.role)try{let e=Math.max(15,Math.round((s.getTime()-l.getTime())/6e4));await o.qC.update(a.resource.id,{duration:e}),h.ZP.success("Appointment duration updated"),await loadAppointments()}catch(e){var r,n;h.ZP.error((null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(r=n.data)||void 0===r?void 0:r.error)||"Failed to resize")}};return t||u?(0,l.jsx)(i.Z,{children:(0,l.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,l.jsx)("div",{className:"text-gray-500",children:"Loading..."})})}):e?("ADMIN"===e.role||e.role,(0,l.jsx)(i.Z,{children:(0,l.jsxs)("div",{className:"px-4 sm:px-0",children:[(0,l.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"Appointments"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Calendar view and quick scheduling"})]}),(0,l.jsx)("button",{onClick:()=>{let e=new Date;y({start:e,end:new Date(e.getTime()+36e5)}),L(e.toISOString().slice(0,10)),_(e.toTimeString().slice(0,5))},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"New Appointment"})]}),p&&(0,l.jsx)("div",{className:"mb-6 rounded-lg bg-red-50 border border-red-200 p-4",children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("svg",{className:"h-5 w-5 text-red-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),(0,l.jsx)("div",{className:"ml-3 text-sm text-red-700",children:p})]})}),(0,l.jsx)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 p-3",children:(0,l.jsx)(AppointmentCalendar,{events:G,defaultView:v,onView:e=>b(e),selectable:!0,onSelectSlot:e=>{x("");let t=new Date(e.start);y({start:e.start,end:e.end}),L(t.toISOString().slice(0,10));let a=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0");_("".concat(a,":").concat(l)),w(60),q("")},onEventDrop:onEventDrop,onEventResize:onEventResize,style:{height:600}})}),g&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:[(0,l.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,l.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:(null==e?void 0:e.role)==="PATIENT"?"Request Appointment":"Create Appointment"})}),(0,l.jsxs)("form",{onSubmit:onCreate,className:"p-4 space-y-4",children:[(null==e?void 0:e.role)!=="PATIENT"?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Patient"}),(0,l.jsxs)("select",{className:"w-full px-3 py-2 border rounded-lg",value:E||"",onChange:e=>k(parseInt(e.target.value)),children:[(0,l.jsx)("option",{value:"",children:"Select patient…"}),Array.isArray(S)&&S.map(e=>(0,l.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Doctor"}),(0,l.jsxs)("select",{className:"w-full px-3 py-2 border rounded-lg",value:T||"",onChange:e=>I(parseInt(e.target.value)),children:[(0,l.jsx)("option",{value:"",children:"Select doctor…"}),Array.isArray(A)&&A.map(e=>(0,l.jsxs)("option",{value:e.id,children:["Dr. ",e.firstName," ",e.lastName]},e.id))]})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Doctor"}),(0,l.jsxs)("select",{className:"w-full px-3 py-2 border rounded-lg",value:T||"",onChange:e=>I(parseInt(e.target.value)),children:[(0,l.jsx)("option",{value:"",children:"Choose a doctor…"}),Array.isArray(A)&&A.map(e=>(0,l.jsxs)("option",{value:e.id,children:["Dr. ",e.firstName," ",e.lastName]},e.id))]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),(0,l.jsx)("input",{type:"date",className:"w-full px-3 py-2 border rounded-lg",value:M,onChange:e=>L(e.target.value)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Time"}),(0,l.jsx)("input",{type:"time",className:"w-full px-3 py-2 border rounded-lg",value:O,onChange:e=>_(e.target.value)})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason"}),(0,l.jsx)("textarea",{className:"w-full px-3 py-2 border rounded-lg",rows:3,value:P,onChange:e=>q(e.target.value)})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start"}),(0,l.jsx)("input",{type:"text",readOnly:!0,className:"w-full px-3 py-2 border rounded-lg bg-gray-50",value:g.start.toLocaleString()})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Duration (minutes)"}),(0,l.jsx)("input",{type:"number",min:15,step:15,value:N,onChange:e=>w(parseInt(e.target.value||"60")),className:"w-full px-3 py-2 border rounded-lg"})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-3 pt-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>y(null),className:"px-4 py-2 border rounded-lg text-gray-700",children:"Cancel"}),(0,l.jsx)("button",{type:"submit",disabled:f,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:f?(null==e?void 0:e.role)==="PATIENT"?"Requesting…":"Creating…":(null==e?void 0:e.role)==="PATIENT"?"Request":"Create"})]})]})]})}),F&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:[(0,l.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,l.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Appointment"})}),(0,l.jsxs)("form",{onSubmit:onSaveEdit,className:"p-4 space-y-4",children:[(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),(0,l.jsx)("input",{type:"date",value:Z,onChange:e=>z(e.target.value),className:"w-full px-3 py-2 border rounded-lg"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Time"}),(0,l.jsx)("input",{type:"time",value:V,onChange:e=>U(e.target.value),className:"w-full px-3 py-2 border rounded-lg"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Duration (minutes)"}),(0,l.jsx)("input",{type:"number",min:15,step:15,value:H,onChange:e=>W(parseInt(e.target.value||"60")),className:"w-full px-3 py-2 border rounded-lg"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes / Cancel Reason"}),(0,l.jsx)("textarea",{rows:3,value:X,onChange:e=>B(e.target.value),className:"w-full px-3 py-2 border rounded-lg"})]}),(0,l.jsxs)("div",{className:"flex justify-between pt-2",children:[(0,l.jsx)("button",{type:"button",onClick:onCancelAppt,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Cancel Appointment"}),(0,l.jsxs)("div",{className:"space-x-3",children:[(0,l.jsx)("button",{type:"button",onClick:()=>R(null),className:"px-4 py-2 border rounded-lg text-gray-700",children:"Close"}),(0,l.jsx)("button",{type:"submit",disabled:f,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:f?"Saving…":"Save"})]})]})]})]})})]})})):null}}},function(e){e.O(0,[770,424,307,862,8,774,888,179],function(){return e(e.s=11051)}),_N_E=e.O()}]);