(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[728],{56036:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/doctor/plans",function(){return a(94328)}])},94328:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return DoctorPlansPage}});var l=a(85893),t=a(67294),r=a(36008),i=a(39367),d=a(46435);function DoctorPlansPage(){let{user:e,loading:s}=(0,i.a)(),[a,n]=(0,t.useState)(!0),[c,o]=(0,t.useState)(""),[x,u]=(0,t.useState)([]),[m,p]=(0,t.useState)([]),[b,h]=(0,t.useState)(!1),[v,g]=(0,t.useState)(""),[y,j]=(0,t.useState)(""),[N,f]=(0,t.useState)(!1),[w,E]=(0,t.useState)(null),[C,k]=(0,t.useState)(null),[S,P]=(0,t.useState)(""),[I,_]=(0,t.useState)(""),[A,T]=(0,t.useState)(3),[q,D]=(0,t.useState)(10),[F,U]=(0,t.useState)("daily"),[M,R]=(0,t.useState)(!1),[H,O]=(0,t.useState)(!1);(0,t.useEffect)(()=>{if(!s&&!e){window.location.href="/login";return}e&&"PHYSIOTHERAPIST"===e.role&&(load(),loadPatients())},[e,s]);let load=async()=>{try{n(!0);let s=await d.NU.list(),a=s.data||s,l=Array.isArray(a)?a:(null==a?void 0:a.therapyPlans)||(null==a?void 0:a.data)||[],t=l.filter(s=>{var a;return(null===(a=s.doctor)||void 0===a?void 0:a.userId)===(null==e?void 0:e.id)});u(t),o("")}catch(e){o(e.message||"Failed to load plans")}finally{n(!1)}},loadPatients=async()=>{try{let e=await d.hA.myPatients(),s=e.data||e,a=Array.isArray(s)?s:(null==s?void 0:s.patients)||(null==s?void 0:s.data)||[];p(a)}catch(e){p([])}},createPlan=async e=>{e.preventDefault();try{f(!0);let e={patientId:parseInt(v),name:y||"Therapy Plan"},s=await d.NU.create(e);if(!s.success)throw Error(s.error||"Failed");h(!1),g(""),j(""),await load()}catch(e){o(e.message||"Failed to create plan")}finally{f(!1)}},addExercise=async e=>{if(e.preventDefault(),w)try{R(!0);let e=await d.NU.addExercise(w.id,{name:S,description:I,sets:A,reps:q,frequency:F});if(!e.success)throw Error(e.error||"Failed");P(""),_(""),T(3),D(10),U("daily"),E(null),await load()}catch(e){o(e.message||"Failed to add exercise")}finally{R(!1)}},openEditModal=(e,s)=>{var a,l;k({...e,planId:s.id}),P((null===(a=e.exercise)||void 0===a?void 0:a.name)||e.name||""),_((null===(l=e.exercise)||void 0===l?void 0:l.description)||e.description||""),T(e.sets||3),D(e.reps||10),U(e.frequency||"daily")},updateExercise=async e=>{if(e.preventDefault(),C)try{var s;O(!0);let e=await d.NU.editExercise(C.planId,C.exerciseId||(null===(s=C.exercise)||void 0===s?void 0:s.id),{name:S,description:I,sets:A,reps:q,frequency:F});if(!e.success)throw Error(e.error||"Failed");k(null),P(""),_(""),T(3),D(10),U("daily"),await load()}catch(e){o(e.message||"Failed to update exercise")}finally{O(!1)}};return s||a?(0,l.jsx)(r.Z,{children:(0,l.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,l.jsx)("div",{className:"text-gray-500",children:"Loading…"})})}):e&&"PHYSIOTHERAPIST"===e.role?(0,l.jsx)(r.Z,{children:(0,l.jsxs)("div",{className:"px-4 sm:px-0",children:[(0,l.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"My Therapy Plans"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Create and manage plans for your patients"})]}),(0,l.jsx)("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"New Plan"})]}),c&&(0,l.jsx)("div",{className:"mb-6 rounded-lg bg-red-50 border border-red-200 p-4",children:(0,l.jsx)("div",{className:"text-sm text-red-700",children:c})}),0===x.length?(0,l.jsx)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 p-6 text-gray-600",children:"No plans yet."}):(0,l.jsx)("div",{className:"space-y-6",children:x.map(e=>{var s,a;return(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[(0,l.jsxs)("div",{className:"p-4 border-b flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"text-lg font-semibold text-gray-900",children:[e.name||"Therapy Plan"," ",(0,l.jsxs)("span",{className:"text-sm text-gray-500",children:["(v",e.version||1,")"]})]}),(0,l.jsxs)("div",{className:"text-sm text-gray-600",children:["Patient: ",null===(s=e.patient)||void 0===s?void 0:s.firstName," ",null===(a=e.patient)||void 0===a?void 0:a.lastName]})]}),(0,l.jsx)("div",{className:"space-x-2",children:(0,l.jsx)("button",{onClick:()=>E(e),className:"px-3 py-1.5 text-sm border rounded",children:"Add Exercise"})})]}),(0,l.jsx)("div",{className:"p-4",children:e.exercises&&0!==e.exercises.length?(0,l.jsx)("ul",{className:"divide-y divide-gray-100",children:e.exercises.slice().sort((e,s)=>(e.order||0)-(s.order||0)).map((s,a)=>{var t,r,i,n;return(0,l.jsx)("li",{className:"py-3",children:(0,l.jsxs)("div",{className:"flex items-start justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"font-medium text-gray-900",children:(null===(t=s.exercise)||void 0===t?void 0:t.name)||s.name}),(null===(r=s.exercise)||void 0===r?void 0:r.description)&&(0,l.jsx)("div",{className:"text-sm text-gray-600",children:s.exercise.description}),(0,l.jsxs)("div",{className:"text-xs text-gray-500",children:[null!==(i=s.sets)&&void 0!==i?i:"-"," sets x ",null!==(n=s.reps)&&void 0!==n?n:"-"," reps • ",s.frequency||"—"]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("button",{onClick:()=>openEditModal(s,e),className:"px-3 py-1.5 text-xs font-medium bg-blue-50 text-blue-700 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors",children:"Edit"}),(0,l.jsx)("button",{onClick:async()=>{if(confirm("Delete this exercise?")){var a;await d.NU.archiveExercise(e.id,s.exerciseId||(null===(a=s.exercise)||void 0===a?void 0:a.id)),await load()}},className:"px-3 py-1.5 text-xs font-medium bg-red-50 text-red-700 border border-red-200 rounded-lg hover:bg-red-100 transition-colors",children:"Delete"}),(0,l.jsx)("button",{disabled:0===a,onClick:async()=>{let s=e.exercises.map((e,s)=>({id:e.id,order:s})),l=s[a];s[a]=s[a-1],s[a-1]=l,await d.NU.reorderExercises(e.id,s),await load()},className:"px-2 py-1.5 text-xs border rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",title:"Move up",children:"↑"}),(0,l.jsx)("button",{disabled:a===e.exercises.length-1,onClick:async()=>{let s=e.exercises.map((e,s)=>({id:e.id,order:s})),l=s[a];s[a]=s[a+1],s[a+1]=l,await d.NU.reorderExercises(e.id,s),await load()},className:"px-2 py-1.5 text-xs border rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",title:"Move down",children:"↓"})]})]})},s.id)})}):(0,l.jsx)("div",{className:"text-gray-500",children:"No exercises in this plan."})})]},e.id)})}),b&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:[(0,l.jsx)("div",{className:"p-4 border-b",children:(0,l.jsx)("h2",{className:"text-xl font-semibold",children:"Create Plan"})}),(0,l.jsxs)("form",{onSubmit:createPlan,className:"p-4 space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Patient"}),(0,l.jsxs)("select",{className:"w-full px-3 py-2 border rounded-lg",required:!0,value:v,onChange:e=>g(e.target.value),children:[(0,l.jsx)("option",{value:"",children:"Select patient…"}),m.map(e=>(0,l.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName]},e.id))]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Plan name"}),(0,l.jsx)("input",{className:"w-full px-3 py-2 border rounded-lg",value:y,onChange:e=>j(e.target.value),placeholder:"e.g., Shoulder Rehab"})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>h(!1),className:"px-4 py-2 border rounded-lg",children:"Cancel"}),(0,l.jsx)("button",{type:"submit",disabled:N,className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:N?"Creating…":"Create"})]})]})]})}),w&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:[(0,l.jsx)("div",{className:"p-4 border-b",children:(0,l.jsx)("h2",{className:"text-xl font-semibold",children:"Add Exercise to Plan"})}),(0,l.jsxs)("form",{onSubmit:addExercise,className:"p-4 space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Exercise name"}),(0,l.jsx)("input",{className:"w-full px-3 py-2 border rounded-lg",value:S,onChange:e=>P(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Description"}),(0,l.jsx)("textarea",{className:"w-full px-3 py-2 border rounded-lg",rows:3,value:I,onChange:e=>_(e.target.value)})]}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Sets"}),(0,l.jsx)("input",{type:"number",min:1,value:A,onChange:e=>T(parseInt(e.target.value||"1")),className:"w-full px-3 py-2 border rounded-lg"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Reps"}),(0,l.jsx)("input",{type:"number",min:1,value:q,onChange:e=>D(parseInt(e.target.value||"1")),className:"w-full px-3 py-2 border rounded-lg"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Frequency"}),(0,l.jsx)("input",{value:F,onChange:e=>U(e.target.value),className:"w-full px-3 py-2 border rounded-lg",placeholder:"e.g., daily"})]})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{E(null),P(""),_(""),T(3),D(10),U("daily")},className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancel"}),(0,l.jsx)("button",{type:"submit",disabled:M,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:M?"Adding…":"Add Exercise"})]})]})]})}),C&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:[(0,l.jsx)("div",{className:"p-4 border-b",children:(0,l.jsx)("h2",{className:"text-xl font-semibold",children:"Edit Exercise"})}),(0,l.jsxs)("form",{onSubmit:updateExercise,className:"p-4 space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Exercise name"}),(0,l.jsx)("input",{className:"w-full px-3 py-2 border rounded-lg",value:S,onChange:e=>P(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Description"}),(0,l.jsx)("textarea",{className:"w-full px-3 py-2 border rounded-lg",rows:3,value:I,onChange:e=>_(e.target.value)})]}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Sets"}),(0,l.jsx)("input",{type:"number",min:1,value:A,onChange:e=>T(parseInt(e.target.value||"1")),className:"w-full px-3 py-2 border rounded-lg"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Reps"}),(0,l.jsx)("input",{type:"number",min:1,value:q,onChange:e=>D(parseInt(e.target.value||"1")),className:"w-full px-3 py-2 border rounded-lg"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Frequency"}),(0,l.jsx)("input",{value:F,onChange:e=>U(e.target.value),className:"w-full px-3 py-2 border rounded-lg",placeholder:"e.g., daily"})]})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{k(null),P(""),_(""),T(3),D(10),U("daily")},className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancel"}),(0,l.jsx)("button",{type:"submit",disabled:H,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:H?"Updating…":"Update Exercise"})]})]})]})})]})}):(0,l.jsx)(r.Z,{children:(0,l.jsx)("div",{className:"text-gray-600",children:"This page is for physiotherapists."})})}}},function(e){e.O(0,[424,8,774,888,179],function(){return e(e.s=56036)}),_N_E=e.O()}]);