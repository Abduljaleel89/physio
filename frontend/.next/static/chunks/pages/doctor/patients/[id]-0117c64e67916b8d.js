(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[750],{84318:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/doctor/patients/[id]",function(){return s(88166)}])},88166:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return PatientProgressPage}});var a=s(85893),l=s(11163),r=s(67294),i=s(36008),n=s(39367),d=s(46435),c=s(29557),o=s(69330),x=s(14195),h=s(3023),m=s(75358),u=s(63440),p=s(10004),g=s(45808),y=s(57783);function PatientProgressPage(){let{user:e,loading:t}=(0,n.a)(),s=(0,l.useRouter)(),{id:b}=s.query,[j,f]=(0,r.useState)(!0),[N,v]=(0,r.useState)(""),[w,P]=(0,r.useState)(null),[S,k]=(0,r.useState)([]),[C,E]=(0,r.useState)([]),[A,D]=(0,r.useState)(!1),[M,T]=(0,r.useState)(""),[_,I]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(!t&&!e){s.push("/login");return}e&&b&&init()},[e,t,b]);let init=async()=>{try{var e;f(!0);let t=await d.NU.list(),s=t.data||t,a=Array.isArray(s)?s:(null==s?void 0:s.therapyPlans)||(null==s?void 0:s.data)||[],l=(a||[]).filter(e=>{var t;return String(e.patientId||(null===(t=e.patient)||void 0===t?void 0:t.id))===String(b)});k(l);let r=(null===(e=l.find(e=>!!e.patient))||void 0===e?void 0:e.patient)||(l[0]?{id:l[0].patientId}:null);P(r);let i=new Date,n=(0,y.Z)(i,14);try{let e=await d.Yu.adherence(n.toISOString(),i.toISOString()),t=e.data||e;if((null==t?void 0:t.daily)&&Array.isArray(t.daily)){let e=t.daily.map(e=>({date:(0,g.ZP)(new Date(e.date),"MMM dd"),completions:e.count||0}));E(e)}else{let e=(null==t?void 0:t.therapyPlans)||[],s={};e.forEach(e=>{if(String(e.patientId)===String(b)){var t;null===(t=e.exerciseBreakdown)||void 0===t||t.forEach(e=>{let t=(0,g.ZP)(new Date,"yyyy-MM-dd");s[t]=(s[t]||0)+(e.completions||0)})}});let a=[];for(let e=0;e<=14;e++){let t=(0,y.Z)(i,14-e),l=(0,g.ZP)(t,"yyyy-MM-dd");a.push({date:(0,g.ZP)(t,"MMM dd"),completions:s[l]||0})}E(a)}}catch(e){console.error("Analytics error",e),E([])}v("")}catch(e){v(e.message||"Failed to load progress")}finally{f(!1)}},assignPlan=async e=>{if(e.preventDefault(),b)try{I(!0);let e=await d.NU.create({patientId:parseInt(b),name:M||"Therapy Plan"});if(!e.success)throw Error(e.error||"Failed");D(!1),T(""),await init()}catch(e){v(e.message||"Failed to assign plan")}finally{I(!1)}};return t||j?(0,a.jsx)(i.Z,{children:(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"text-gray-500",children:"Loading…"})})}):e&&"PHYSIOTHERAPIST"===e.role?(0,a.jsx)(i.Z,{children:(0,a.jsxs)("div",{className:"px-4 sm:px-0",children:[(0,a.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("button",{onClick:()=>window.history.back(),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-gray-900",children:"Patient Progress"}),w&&(0,a.jsxs)("p",{className:"text-gray-600 mt-1",children:[w.firstName," ",w.lastName,w.regNumber&&(0,a.jsxs)("span",{className:"ml-2 text-sm text-gray-500",children:["(",w.regNumber,")"]})]})]})]})}),(0,a.jsx)("button",{onClick:()=>D(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium shadow-md hover:shadow-lg transition-all",children:"Create Therapy Plan"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 p-6 mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Adherence Overview (Last 14 days)"}),C.length>0?(0,a.jsx)("div",{className:"h-64",children:(0,a.jsx)(c.h,{width:"100%",height:"100%",children:(0,a.jsxs)(o.w,{data:C,margin:{top:5,right:30,left:20,bottom:5},children:[(0,a.jsx)(x.q,{strokeDasharray:"3 3",className:"stroke-gray-200"}),(0,a.jsx)(h.K,{dataKey:"date",className:"text-sm text-gray-600"}),(0,a.jsx)(m.B,{allowDecimals:!1,className:"text-sm text-gray-600"}),(0,a.jsx)(u.u,{contentStyle:{backgroundColor:"#fff",borderColor:"#e5e7eb",borderRadius:"0.5rem",boxShadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1)"},labelStyle:{color:"#1f2937",fontWeight:"600"},itemStyle:{color:"#4b5563"}}),(0,a.jsx)(p.x,{type:"monotone",dataKey:"completions",stroke:"#2563eb",strokeWidth:2,activeDot:{r:8},name:"Completions"})]})})}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("p",{children:"No adherence data available for this patient yet."}),(0,a.jsx)("p",{className:"text-sm mt-2",children:"Data will appear once the patient starts completing exercises."})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200",children:[(0,a.jsxs)("div",{className:"p-4 border-b flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Therapy Plans"}),(0,a.jsx)("button",{onClick:()=>D(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium",children:"Create Plan"})]}),(0,a.jsx)("div",{className:"p-4",children:0===S.length?(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("p",{children:"No therapy plans assigned to this patient yet."}),(0,a.jsx)("p",{className:"text-sm mt-2",children:"Create a plan to get started."})]}):(0,a.jsx)("div",{className:"space-y-4",children:S.map(e=>{var t;return(0,a.jsx)("div",{className:"p-4 border border-gray-200 rounded-lg hover:border-blue-300 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name||"Therapy Plan"}),(0,a.jsxs)("span",{className:"text-xs font-medium px-2 py-1 bg-blue-100 text-blue-800 rounded-full",children:["v",e.version||1]}),(0,a.jsx)("span",{className:"text-xs font-medium px-2 py-1 rounded-full ".concat("ACTIVE"===e.status?"bg-green-100 text-green-800":"COMPLETED"===e.status?"bg-gray-100 text-gray-800":"bg-yellow-100 text-yellow-800"),children:e.status||"ACTIVE"})]}),(null===(t=e.exercises)||void 0===t?void 0:t.length)?(0,a.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:[(0,a.jsx)("span",{className:"font-medium",children:e.exercises.length})," ",1===e.exercises.length?"exercise":"exercises"]}):(0,a.jsx)("div",{className:"text-sm text-gray-500 mb-2",children:"No exercises in this plan"}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:e.description})]}),(0,a.jsx)("div",{className:"ml-4",children:(0,a.jsx)("a",{href:"/therapy-plans/detail?id=".concat(e.id),className:"px-3 py-1.5 text-sm font-medium bg-blue-50 text-blue-700 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors",children:"View Details"})})]})},e.id)})})})]}),A&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:[(0,a.jsx)("div",{className:"p-4 border-b",children:(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Assign Therapy Plan"})}),(0,a.jsxs)("form",{onSubmit:assignPlan,className:"p-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Plan name"}),(0,a.jsx)("input",{className:"w-full px-3 py-2 border rounded-lg",value:M,onChange:e=>T(e.target.value),placeholder:"e.g., Back Rehab"})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>D(!1),className:"px-4 py-2 border rounded-lg",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:_,className:"px-4 py-2 bg-blue-600 text-white rounded-lg",children:_?"Assigning…":"Assign"})]})]})]})})]})}):(0,a.jsx)(i.Z,{children:(0,a.jsx)("div",{className:"text-gray-600",children:"For physiotherapists only."})})}},57783:function(e,t,s){"use strict";var a=s(21860);function subDays(e,t,s){return(0,a.E)(e,-t,s)}t.Z=subDays}},function(e){e.O(0,[424,192,307,8,774,888,179],function(){return e(e.s=84318)}),_N_E=e.O()}]);