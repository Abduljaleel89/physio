(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[769],{81865:function(e,a,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/notifications",function(){return r(60370)}])},60370:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return NotificationsPage}});var t=r(85893),s=r(67294),d=r(36008),l=r(39367),i=r(46435);function NotificationsPage(){let{user:e,loading:a}=(0,l.a)(),[r,o]=(0,s.useState)([]),[n,c]=(0,s.useState)(!0),[x,g]=(0,s.useState)(""),[m,y]=(0,s.useState)(!1),[u,b]=(0,s.useState)(""),[h,p]=(0,s.useState)(""),[k,v]=(0,s.useState)(""),[f,j]=(0,s.useState)(1),[N,w]=(0,s.useState)(10),[C,S]=(0,s.useState)(0);(0,s.useEffect)(()=>{if(!a&&!e){window.location.href="/login";return}e&&load()},[e,a,f,N]);let buildParams=()=>{let e={page:f,pageSize:N};return u&&(e.type=u),h&&(e.startDate=h),k&&(e.endDate=k),m&&(e.read="false"),e},load=async()=>{try{c(!0);let e=await i.BT.list(buildParams()),a=e.data||e,r=Array.isArray(a)?a:(null==a?void 0:a.notifications)||(null==a?void 0:a.data)||[],t="number"==typeof(null==a?void 0:a.total)?a.total:r.length;o(r),S(t),g("")}catch(e){g(e.message||"Failed to load notifications")}finally{c(!1)}},applyFilters=async e=>{e.preventDefault(),j(1),await load()},clearFilters=async()=>{b(""),p(""),v(""),y(!1),j(1),await load()},markRead=async e=>{try{await i.BT.markRead(e),o(a=>a.map(a=>a.id===e?{...a,read:!0}:a))}catch(e){}},markAll=async()=>{try{await i.BT.markAll(),o(e=>e.map(e=>({...e,read:!0})))}catch(e){}},exportCsv=async()=>{try{let e={...buildParams(),page:1,pageSize:1e3},a=await i.BT.list(e),r=a.data||a,t=Array.isArray(r)?r:(null==r?void 0:r.notifications)||(null==r?void 0:r.data)||[],s=t.map(e=>{var a,r,t,s;return[String(null!==(a=e.id)&&void 0!==a?a:""),(null!==(r=e.title)&&void 0!==r?r:"").replaceAll('"','""'),(null!==(t=e.message)&&void 0!==t?t:"").replaceAll('"','""'),String(null!==(s=e.type)&&void 0!==s?s:""),e.read?"true":"false",e.createdAt?new Date(e.createdAt).toISOString():""]}),d=["id,title,message,type,read,createdAt",...s.map(e=>e.map(e=>/[",\n]/.test(e)?'"'.concat(e,'"'):e).join(","))].join("\n"),l=new Blob([d],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(l),n=document.createElement("a");n.href=o;let c=new Date().toISOString().slice(0,10);n.download="notifications-".concat(c,".csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o)}catch(e){}},A=Math.max(1,Math.ceil(C/N));return(0,t.jsx)(d.Z,{children:(0,t.jsxs)("div",{className:"px-4 sm:px-0",children:[(0,t.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-4xl font-bold text-gray-900 dark:text-gray-50 mb-2",children:"Notifications"}),(0,t.jsx)("p",{className:"text-gray-700 dark:text-gray-300",children:"Filter and review your notifications"})]}),(0,t.jsxs)("div",{className:"space-x-2",children:[(0,t.jsx)("button",{onClick:exportCsv,className:"px-4 py-2 border border-gray-300 dark:border-slate-600 rounded-lg text-sm text-gray-700 dark:text-gray-200 bg-white dark:bg-slate-700 hover:bg-gray-50 dark:hover:bg-slate-600 transition-colors",children:"Export CSV"}),(0,t.jsx)("button",{onClick:markAll,className:"px-4 py-2 border border-gray-300 dark:border-slate-600 rounded-lg text-sm text-gray-700 dark:text-gray-200 bg-white dark:bg-slate-700 hover:bg-gray-50 dark:hover:bg-slate-600 transition-colors",children:"Mark all as read"}),(0,t.jsx)("button",{onClick:load,className:"px-4 py-2 border border-gray-300 dark:border-slate-600 rounded-lg text-sm text-gray-700 dark:text-gray-200 bg-white dark:bg-slate-700 hover:bg-gray-50 dark:hover:bg-slate-600 transition-colors",children:"Refresh"})]})]}),x&&(0,t.jsx)("div",{className:"mb-6 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 p-4",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("svg",{className:"h-5 w-5 text-red-600 dark:text-red-400",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),(0,t.jsx)("div",{className:"ml-3 text-sm text-red-800 dark:text-red-300 font-medium",children:x})]})}),(0,t.jsx)("form",{onSubmit:applyFilters,className:"mb-4 card",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3 items-end",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Type"}),(0,t.jsxs)("select",{value:u,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500",children:[(0,t.jsx)("option",{value:"",children:"All"}),(0,t.jsx)("option",{value:"INFO",children:"Info"}),(0,t.jsx)("option",{value:"WARNING",children:"Warning"}),(0,t.jsx)("option",{value:"ALERT",children:"Alert"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Start date"}),(0,t.jsx)("input",{type:"date",value:h,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"End date"}),(0,t.jsx)("input",{type:"date",value:k,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("input",{id:"unreadOnly",type:"checkbox",className:"rounded w-4 h-4 text-primary-600 border-gray-300 dark:border-slate-600 focus:ring-primary-500",checked:m,onChange:e=>y(e.target.checked)}),(0,t.jsx)("label",{htmlFor:"unreadOnly",className:"text-sm text-gray-700 dark:text-gray-300",children:"Unread only"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 md:justify-end",children:[(0,t.jsx)("button",{type:"button",onClick:clearFilters,className:"px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-lg text-sm text-gray-700 dark:text-gray-200 bg-white dark:bg-slate-700 hover:bg-gray-50 dark:hover:bg-slate-600 transition-colors",children:"Clear"}),(0,t.jsx)("button",{type:"submit",className:"px-3 py-2 bg-gradient-to-r from-primary-600 to-primary-500 dark:from-primary-500 dark:to-primary-600 text-white rounded-lg text-sm hover:from-primary-700 hover:to-primary-600 dark:hover:from-primary-600 dark:hover:to-primary-700 transition-all shadow-md hover:shadow-lg",children:"Apply"})]})]})}),(0,t.jsx)("div",{className:"card",children:n?(0,t.jsx)("div",{className:"p-6 text-gray-700 dark:text-gray-300",children:"Loading…"}):0===r.length?(0,t.jsx)("div",{className:"p-6 text-gray-700 dark:text-gray-300",children:"No notifications"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("ul",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:r.map(e=>(0,t.jsx)("li",{className:"p-4 ".concat(e.read?"":"bg-primary-50 dark:bg-primary-900/20"),children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-50",children:e.title||"Notification"}),e.type&&(0,t.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:e.type}),e.message&&(0,t.jsx)("div",{className:"text-sm text-gray-800 dark:text-gray-200 mt-1",children:e.message}),e.createdAt&&(0,t.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:new Date(e.createdAt).toLocaleString()})]}),!e.read&&(0,t.jsx)("button",{onClick:()=>markRead(e.id),className:"text-xs text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 hover:underline font-medium transition-colors",children:"Mark read"})]})},e.id))}),(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 border-t border-gray-200 dark:border-slate-700",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Page ",f," of ",A," • ",C," total"]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("select",{value:N,onChange:e=>{w(parseInt(e.target.value)),j(1)},className:"px-2 py-1 border border-gray-300 dark:border-slate-600 rounded text-sm bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500",children:[10,20,50,100].map(e=>(0,t.jsxs)("option",{value:e,children:[e," / page"]},e))}),(0,t.jsx)("button",{disabled:f<=1,onClick:()=>j(e=>Math.max(1,e-1)),className:"px-3 py-1 border border-gray-300 dark:border-slate-600 rounded text-sm text-gray-700 dark:text-gray-200 bg-white dark:bg-slate-700 hover:bg-gray-50 dark:hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Prev"}),(0,t.jsx)("button",{disabled:f>=A,onClick:()=>j(e=>Math.min(A,e+1)),className:"px-3 py-1 border border-gray-300 dark:border-slate-600 rounded text-sm text-gray-700 dark:text-gray-200 bg-white dark:bg-slate-700 hover:bg-gray-50 dark:hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Next"})]})]})]})})]})})}}},function(e){e.O(0,[424,8,774,888,179],function(){return e(e.s=81865)}),_N_E=e.O()}]);